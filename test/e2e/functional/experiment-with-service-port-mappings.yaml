apiVersion: argoproj.io/v1alpha1
kind: Experiment
metadata:
  name: experiment-with-service-port-mappings
spec:
  duration: 10s
  scaleDownDelaySeconds: 5
  # List of pod template specs to run in the experiment as ReplicaSets
  templates:
    - name: test
      replicas: 1
      service:
        name: test-service-with-port-mappings
        portMappings:
          - port: 80
            containerPort: 8080
          - port: 81
            containerPort: 8081
      selector:
        matchLabels:
          app: xperiment-with-service-port-mappings
      template:
        metadata:
          labels:
            app: xperiment-with-service-port-mappings
        spec:
          containers:
            - name: xperiment-with-service-port-mappings
              image: nginx:1.19-alpine
              resources:
                requests:
                  memory: 16Mi
                  cpu: 1m
              ports:
                 - name: testport1
                   protocol: TCP
                   containerPort: 8080
                 - name: testport2
                   protocol: TCP
                   containerPort: 8081
